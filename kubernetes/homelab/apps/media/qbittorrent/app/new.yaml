---
apiVersion: v1
kind: Pod
metadata:
  name: pvc-copy
  namespace: media
spec:
  containers:
    - name: copy
      image: ubuntu:22.04
      command:
        - /bin/sh
        - -c
        - |
          apt-get update && apt-get install -y rsync
          rsync -av /source/ /destination/
          echo "Copy complete"
          sleep infinity
      volumeMounts:
        - name: qbittorrent
          mountPath: /source
        - name: qbittorrent-replicated
          mountPath: /destination
  volumes:
    - name: qbittorrent
      persistentVolumeClaim:
        claimName: qbittorrent
    - name: qbittorrent-replicated
      persistentVolumeClaim:
        claimName: qbittorrent-replicated
---
kind: PersistentVolumeClaim
apiVersion: v1
metadata:
  name: qbittorrent-replicated
spec:
  storageClassName: freenas-api-iscsi-retain
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
