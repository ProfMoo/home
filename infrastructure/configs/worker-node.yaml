machine:
  nodeLabels:
    kubernetes.io/role: ${node_type}
    kubernetes.io/zone: ${proxmox_node}
  install:
    extensions:
      - image: "ghcr.io/siderolabs/qemu-guest-agent:${qemu_guest_agent_version}"
  kubelet:
    defaultRuntimeSeccompProfileEnabled: true
    disableManifestsDirectory: true
    extraArgs:
      rotate-server-certificates: true
  network:
    hostname: ${hostname}
    # # NOTE: This tells any worker nodes who need to communicate with the control plane
    # # (which would use the Kube API DNS records to instead use the Talos virtual IP.
    # extraHostEntries:
    #   - ip: ${talos_virtual_ip}
    #     aliases:
    #       - kubernetes.default.svc.cluster.local
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
cluster:
  proxy:
    disabled: true
  controlPlane:
    endpoint: https://${talos_virtual_ip}:6443
  network:
    podSubnets: ${format("%#v",split(",",pod_subnets))}
    serviceSubnets: ${format("%#v",split(",",service_subnets))}
