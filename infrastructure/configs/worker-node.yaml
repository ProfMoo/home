machine:
  nodeLabels:
    drmoo.io/role: ${node_type}
    drmoo.io/zone: ${proxmox_node}
  install:
    extensions:
      - image: "ghcr.io/siderolabs/qemu-guest-agent:${qemu_guest_agent_version}"
      - image: "ghcr.io/siderolabs/iscsi-tools:0.1.4"
  kubelet:
    defaultRuntimeSeccompProfileEnabled: true
    disableManifestsDirectory: true
    extraArgs:
      rotate-server-certificates: true
  network:
    hostname: ${hostname}
  features:
    rbac: true
    stableHostname: true
    apidCheckExtKeyUsage: true
  files:
    - op: overwrite
      path: /etc/nfsmount.conf
      permissions: 0o644
      content: |
        [ NFSMount_Global_Options ]
        nfsvers=4.1
        hard=True
        noatime=True
        nodiratime=True
        rsize=131072
        wsize=131072
        nconnect=8
cluster:
  network:
    podSubnets: ${format("%#v",split(",",pod_subnets))}
    serviceSubnets: ${format("%#v",split(",",service_subnets))}
  proxy:
    disabled: true
  controlPlane:
    endpoint: https://${talos_virtual_ip}:6443
