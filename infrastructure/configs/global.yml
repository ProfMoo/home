machine:
  features:
    kubePrism:
      enabled: true
      port: 7445
  install:
    extensions:
      - image: "ghcr.io/siderolabs/qemu-guest-agent:${qemu_guest_agent_version}"
  kubelet:
    extraArgs:
      rotate-server-certificates: true
  network:
    hostname: ${hostname}
  nodeLabels:
    type: ${node_type}
cluster:
  proxy:
    # We need to override the default bind address so that the /metrics endpoint is able to be scraped by Prometheus
    # Further discussion: https://github.com/siderolabs/talos/discussions/7799
    #
    # Additional note: kube-proxy needs a special application process compared to most machineconfig changes.
    # Source: https://github.com/siderolabs/talos/discussions/7835
    extraArgs:
      metrics-bind-address: 0.0.0.0:10249
  # etcd:
  #   extraArgs:
  #     # NOTE: This enables Prometheus to scrape metrics from the control plane nodes
  #     listen-metrics-urls: http://0.0.0.0:2381
  controllerManager:
    extraArgs:
      # NOTE: This enables Prometheus to scrape metrics from the control plane nodes
      bind-address: 0.0.0.0
  scheduler:
    extraArgs:
      # NOTE: This enables Prometheus to scrape metrics from the control plane nodes
      bind-address: 0.0.0.0
