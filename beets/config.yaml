plugins:
  - fromfilename
  - discogs
  - fetchart
  - bandcamp
  - embedart
  - spotify
  - duplicates
  - yearfixer
  - extrafiles
  - acousticbrainz
  - chroma
  - mbsync

threaded: yes

# NOTE: This assumes that the music directory is mounted here
directory: /music
library: /music/beets.db
asciify_paths: true

# Pointing beets to the file where we keep the list of directories
# we've already imported
statefile: /volume/state.pickle

import:
  write: yes
  duplicate_action: keep
  autotag: yes
  resume: yes

  # Ensures that the import process doesn't ask for feedback
  # and then fail with the lack of STDIN
  quiet: yes
  quiet_fallback: asis # If no strong rec, still import "asis"

  # WHEN SHIFTING TO MOVE, CHANGE THIS TO 'no' AND REMOVE 'incremental_skip_later'
  # incremental: yes
  # incremental_skip_later: yes

  # These fields only affect interactive (i.e not quiet) mode
  default_action: apply
  none_rec_action: asis

  move: yes
  log: /volume/log.txt

max_filename_length: 255
art_filename: cover

# Removing characters that could cause issues on filesystem or on S3
replace:
  '[\\/]': _
  '^\.': _
  '[\x00-\x1f]': _
  '[<>:"\?\*\|]': _
  '\.$': _
  '\s+$': ""
  '^\s+': ""
  "^-": _
  '[\[\{]': (
  '[\]\}]': )
  '[\^\%\`\~#]': _

extrafiles:
  patterns:
    all:
      - "*.jpg"
      - "*.png"
      - "*.jpeg"
      - "*.pdf"
      - "*.txt"

clutter:                     # When beets imports all the files in a directory, it tries to remove the directory if it’s empty.
                             # A directory is considered empty if it only contains files whose names match the glob patterns in clutter,
                             # which should be a list of strings.
                             # The importer only removes recursively searched subdirectories—the top-level directory you specify on the command line is never deleted.
  [
  .DS_Store,                 # Default.
  Thumbs.DB                  # Default.
  ]

match:
  strong_rec_thresh: 0.12
  # Block matches when there are missing/unmatched tracks
  ignored: missing_tracks unmatched_tracks

paths:
  default: $albumartist/$album%aunique{}/$track $title
  singleton: Non-Album/$artist/$title
  comp: Compilations/$album%aunique{}/$track $title

# To get a better sense of how beets is differentiating very similar albums (ex: Deluxe editions), use this query:
# beet ls -af '$album - $albumtype - $year - $label - $catalognum - $albumdisambig - $releasegroupdisambig - $format'
# Helpful query when disambiguating between extremely similar albums (ex: Kanye's multiple Donda releases):
# beet modify -a album:Dona ^albumdisambig:deluxe ^albumdisambig:24bit albumdisambig="Original Release"
# For deluxe editions, special releases, etc, use the 'albumdisambig'
aunique:
  keys: albumartist album
  disambiguators: albumtype year label catalognum albumdisambig releasegroupdisambig
  bracket: '()'

musicbrainz:
  source_weight: 0.2
  extra_tags:
    - year
    - catalognum,
    - country,
    - label,
    - media

discogs:
  user_token: dkVyfeemJydxHxvQxAcTWMGHsAvfAwvAKwVuEXTn
  source_weight: 0.0
  extra_tags: [year]

spotify:
  source_weight: 0.2

bandcamp:
  include_digital_only_tracks: true
  search_max: 5
  art: yes

fetchart:
  auto: yes # Enable automatic album art fetching during import.
  cautious: no # Pick only trusted album art by ignoring filenames that do not contain one of the keywords in "cover_names".
  enforce_ratio: yes # Only allow images with 1:1 aspect ratio
  minwidth: 500 # Only images with a width bigger or equal to minwidth are considered as valid album art candidates.
  maxwidth:
    3000 # A maximum image width to downscale fetched images if they are too big.
    # The height is recomputed so that the aspect ratio is preserved.
  sources: # An asterisk * expands to all available sources.
    - filesystem # No remote art sources are queried if local art is found in the filesystem.
    - coverart
    - albumart
    - bandcamp
    - fanarttv
    - bandcamp
  store_source: yes # Store the art source (e.g. filesystem) in the beets database as art_source.

embedart:
  auto: yes

# Preferring the higher bitrate
duplicates:
  tiebreak:
    items: [bitrate]

chroma:
  auto: yes

check:
  import: yes # Add checksums for new files during the import process. # This also disables integrity checks on import and will not ask you to skip the import of corrupted files.
  write-check: yes # Verify checksums before writing files with beet write or beet modify.
  write-update: yes # Update checksums after writing files with beet write or beet modify.
  convert-update: no # Update the checksum if a file has been converted with the --keep-new flag.
  threads: 2 # Threads to compute checksums.

# AcousticBrainz ##################################################################################

absubmit: # The absubmit plugin lets you submit acoustic analysis results to the AcousticBrainz server.
  auto: yes # Analyze every file on import. Otherwise, you need to use the beet absubmit command explicitly. Default: no
  force: no # Analyze items and submit of AcousticBrainz data even for tracks that already have it. Default: no.
  pretend: no # Do not analyze and submit of AcousticBrainz data but print out the items which would be processed. Default: no.

acoustid:
  apikey: QqnLdUzcLa

acousticbrainz: # The acousticbrainz plugin gets acoustic-analysis information from the AcousticBrainz project.
  auto: yes # Enable AcousticBrainz during beet import. Default: yes.
  force: yes # Download AcousticBrainz data even for tracks that already have it. Default: no.
